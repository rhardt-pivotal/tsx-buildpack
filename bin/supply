#!/bin/sh
# set -e
set -x
if [ -z ${TSX_TAR_URI+x} ]
then
  echo "TSX_TAR_URI env var not set"
  exit 1
fi
if [ -z ${TSX_ARGS+x} ]
then
  echo "TSX_ARGS not set"
  exit 1
fi

echo "*************  Running supply"

wget $TSX_TAR_URI --quiet -O ./tsx.tar

ls -al

mkdir $3/$4/tsx-installer
tar xf tsx.tar -C $3/$4/tsx-installer --strip-components 1 



SCRIPTS_DIR="$( cd "$(dirname "$0")" ; pwd -P )/../scripts"
$SCRIPTS_DIR/bp_install.sh $3/$4/tsx-installer/


cat <<'EOF' >> $3/$4/launch.yml
#!/usr/bin/env bash
---
processes:
- type: "sidecar_process"
  command: "while true; do echo hello from a sidecar process; sleep 10; done"
  platforms:
    cloudfoundry:
      sidecar_for: [ "web"]
EOF
